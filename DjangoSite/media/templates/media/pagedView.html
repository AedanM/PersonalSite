{% load static %} {% load DictTags %}
<!DOCTYPE html>
<html
	data-bs-theme="{{colorMode}}"
	data-theme="{{colorMode}}">
	<head>
		<meta charset="iso-8859-15" />

		<meta
			http-equiv="X-UA-Compatible"
			content="IE=edge" />
		<title>Media Server Description</title>
		<meta
			name="description"
			content="" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet" />
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.css" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
		<link
			rel="stylesheet"
			href="{% static 'styles/MasterStyle.css' %}" />
		<link
			rel="stylesheet"
			href="{% static 'styles/MediaStyle.css' %}" />
	</head>
	<script>
		function SetUrlParam(key, value, append = false) {
			const urlParams = new URLSearchParams(window.location.search);
			if (typeof key == "string") {
				key = [key];
			}
			if (typeof value == "string") {
				value = [value];
			}
			for (let i = 0; i < key.length; i++) {
				if (value[i] != "") {
					let newVal = String(value[i]);
					if (append) {
						oldTags = urlParams.get(key[i]);
						if (oldTags != undefined) {
							if (oldTags.includes(newVal)) {
								newVal = oldTags.replace(newVal, "");
							} else {
								newVal = oldTags + "," + newVal;
							}
							console.log(newVal);
						}
						if (newVal.slice(0, 1) == ",") {
							newVal = newVal.substring(1);
						}
						if (newVal.slice(-1) == ",") {
							newVal = newVal.substring(-1);
						}
						console.log(newVal, newVal.slice(0, 1), newVal.slice(-1));
					}
					if (newVal != "") {
						urlParams.set(key[i], newVal);
					} else {
						urlParams.delete(key[i]);
					}
				} else {
					urlParams.delete(key[i]);
				}
			}
			window.location.search = urlParams;
		}
		function ToggleMode() {
			let newMode = "dark";
			if ("{{colorMode}}" == "dark") {
				newMode = "light";
			}
			document.cookie = "colorMode=" + newMode;
			console.log("Toggled?");
			document.location.reload();
		}
	</script>
	<body>
		<main
			class="container"
			height-min="0.75uh">
			<header class="pico">
				<nav>
					<ul>
						<li>
							<strong>Media Server</strong>
						</li>
					</ul>
					<ul>
						<li>
							<a href="/resume">About</a>
						</li>
						<li>
							<a href="/media">Media Server Access</a>
						</li>
						<li>
							<a href="/admin">Admin</a>
						</li>
					</ul>
				</nav>
			</header>

			<div class="d-flex justify-content-center">
				<a
					class="clean-link me-3"
					onclick="SetUrlParam(['page', 'genre', 'exclude', 'query', 'sort'], ['','','','',''])">
					<i class="bi bi-house-fill"></i
				></a>
				<a
					class="clean-link flex-grow-1"
					onclick="document.location = '/media/stats'">
					<i class="bi bi-bar-chart-line"></i
				></a>
				<div class="flex-grow-1">
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['Movie','',''])">
						<i class="mx-3 bi bi-film"></i>
					</button>
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['TV Show','',''])">
						<i class="mx-3 bi bi-tv"></i>
					</button>
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['Comic','',''])">
						<i class="mx-3 bi bi-book"></i>
					</button>
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['Book','',''])">
						<i class="mx-3 bi bi-journal-bookmark"></i>
					</button>
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['Album','',''])">
						<i class="mx-3 bi bi-vinyl"></i>
					</button>
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['Podcast','',''])">
						<i class="mx-3 bi bi-mic"></i>
					</button>
					<button
						class="clean-button"
						onclick="SetUrlParam(['type', 'sort', 'page'], ['Youtube','',''])">
						<i class="mx-3 bi bi-youtube"></i>
					</button>
				</div>
				<button
					class="clean-button"
					onclick="document.location = '/media/wiki'">
					<i class="mx-3 bi bi-wikipedia"></i>
				</button>
				<button
					class="btn"
					onclick="ToggleMode()">
					{% if colorMode == "light" %}<i class="bi bi-moon-stars-fill"></i>{%else%}<i class="bi bi-sun-fill"></i
					>{%endif%}
				</button>
			</div>
			<div class="d-flex justify-content-center">
				<details class="flex-grow-1">
					<summary><i class="bi bi-funnel-fill"></i></summary>
					<input
						type="Search"
						placeholder="Search"
						onkeydown="if (event.key =='Enter') {SetUrlParam('query', this.value)}" />
					<select onchange="SetUrlParam('sort', this.value)">
						<option
							selected
							value="">
							Sort Value
						</option>
						{% for tag in page_obj|GetAttrs %}
						<option value="{{tag}}">{{tag}}</option>
						{%endfor%} {% if page_obj.0.Total_Length %}
						<option value="Total_Length">Total Length</option>
						{%endif%}
					</select>
					<details>
						<summary>Include</summary>
						<button
							onclick="SetUrlParam(['genre', 'page'],['watched', ''], true)"
							class="btn btn-outline-success m-1">
							Watched
						</button>
						<button
							onclick="SetUrlParam(['genre', 'page'],['downloaded', ''], true)"
							class="btn btn-outline-success m-1">
							Downloaded
						</button>
						<table>
							<tr>
								<td>Major Tags</td>
								<td>
									{% for item, freq in Tags.items %} {% if freq > 15 %} {% if item not in filters|Get:"include"%}
									<button
										onclick="SetUrlParam(['genre', 'page'],['{{item}}', ''], true)"
										class="btn btn-outline-primary m-1">
										{{item}} ({{freq}})
									</button>
									{%else%}
									<button
										onclick="SetUrlParam(['genre', 'page'],['{{item}}', ''], true)"
										class="btn btn-primary m-1">
										{{item}} ({{freq}})
									</button>
									{%endif%} {%endif%} {% endfor %}
								</td>
							</tr>
							<tr>
								<td>Minor Tags</td>
								<td>
									<!-- prettier-ignore -->
									{% for item, freq in Tags.items %} {% if freq <= 15 and freq > 5 %} {% if item not in filters|Get:"include"%}
									<button
										onclick="SetUrlParam(['genre', 'page'],['{{item}}', ''], true)"
										class="btn btn-outline-info m-1">
										{{item}} ({{freq}})
									</button>
									{%else%}
									<button
										onclick="SetUrlParam(['genre', 'page'],['{{item}}', ''], true)"
										class="btn btn-info m-1">
										{{item}} ({{freq}})
									</button>
									{%endif%} {%endif%} {% endfor %}
								</td>
							</tr>
							<tr>
								<td>Specific Tags</td>
								<td>
									<!-- prettier-ignore -->
									{% for item, freq in Tags.items %} {% if freq <= 5 %} {% if item not in filters|Get:"include"%}
									<button
										onclick="SetUrlParam(['genre', 'page'],['{{item}}', ''], true)"
										class="btn btn-outline-light m-1">
										{{item}} ({{freq}})
									</button>
									{%else%}
									<button
										onclick="SetUrlParam(['genre', 'page'],['{{item}}', ''], true)"
										class="btn btn-light m-1">
										{{item}} ({{freq}})
									</button>
									{%endif%} {%endif%} {% endfor %}
								</td>
							</tr>
						</table>
					</details>
					<details>
						<summary>Exclude</summary>
						<button
							onclick="SetUrlParam(['exclude', 'page'],['watched', ''], true)"
							class="btn btn-outline-success m-1">
							Watched
						</button>
						<button
							onclick="SetUrlParam(['exclude', 'page'],['downloaded', ''], true)"
							class="btn btn-outline-success m-1">
							Downloaded
						</button>
						<table>
							<tr>
								<td>Major Tags</td>
								<td>
									<!-- prettier-ignore -->
									{% for item, freq in Tags.items %} {% if freq > 15 %} {% if item not in filters|Get:"exclude"%}
									<button
										onclick="SetUrlParam(['exclude', 'page'],['{{item}}', ''], true)"
										class="btn btn-outline-primary m-1">
										{{item}} ({{freq}})
									</button>
									{%else%}
									<button
										onclick="SetUrlParam(['exclude', 'page'],['{{item}}', ''], true)"
										class="btn btn-primary m-1">
										{{item}} ({{freq}})
									</button>
									{%endif%} {%endif%} {% endfor %}
								</td>
							</tr>
							<tr>
								<td>Minor Tags</td>
								<td>
									<!-- prettier-ignore -->
									{% for item, freq in Tags.items %} {% if freq <= 15 and freq > 5 %} {% if item not in filters|Get:"exclude"%}
									<button
										onclick="SetUrlParam(['exclude', 'page'],['{{item}}', ''], true)"
										class="btn btn-outline-info m-1">
										{{item}} ({{freq}})
									</button>
									{%else%}
									<button
										onclick="SetUrlParam(['exclude', 'page'],['{{item}}', ''], true)"
										class="btn btn-info m-1">
										{{item}} ({{freq}})
									</button>
									{%endif%} {%endif%} {% endfor %}
								</td>
							</tr>
							<tr>
								<td>Specific Tags</td>
								<td>
									{% for item, freq in Tags.items %} {% if freq <= 5 %} {% if item not in filters|Get:"exclude"%}
									<button
										onclick="SetUrlParam(['exclude', 'page'],['{{item}}', ''], true)"
										class="btn btn-outline-light m-1">
										{{item}} ({{freq}})
									</button>
									{%else%}
									<button
										onclick="SetUrlParam(['exclude', 'page'],['{{item}}', ''], true)"
										class="btn btn-light m-1">
										{{item}} ({{freq}})
									</button>
									{%endif%} {%endif%} {% endfor %}
								</td>
							</tr>
						</table>
					</details>
				</details>
			</div>
			<div class="d-flex flex-column">
				<div>
					<div class="d-flex flex-wrap justify-content-center gap-3">
						{% for show in page_obj %}
						<div class="my-1 card grow">
							<a href="{{show.InfoPage}}">
								{% if not show|HasAttr:"Length" or show|HasAttr:"Creator"%}
								<img
									class="card-img-top movie-logo"
									src="{%static show.Logo%}"
									alt="{{show.Title}}" />{%else%}<img
									class="card-img-top tv-logo"
									src="{%static show.Logo%}"
									alt="{{show.Title}}" />{%endif%}</a
							>
							<div class="card-body">
								<div class="d-flex">
									<a
										href="view?id={{show.id}}"
										class="clean-link"
										><strong class="card-title flex-grow-1">{{show.Title}}</strong></a
									>
								</div>
								<div class="d-flex">
									<p class="flex-grow-1">{{show.Year}}{{show.Length}}{% if show|HasAttr:"Length"%} Eps{% endif %}</p>
									{% if show.Rating != 0 %}
									<p
										id="rating"
										class="flex-grow-1">
										{{show.Rating|rating}}
									</p>
									{%endif%}
									<p>{{show.Duration}}</p>
								</div>

								<div class="d-flex flex-wrap justify-content-center">
									{% for genre in show.GenreTagList %} {%if genre not in filters|Get:"include"%}
									<span class="genre-badge badge rounded-pill bg-secondary"
										><button
											onclick="SetUrlParam(['genre', 'page', 'query'],['{{genre}}', '',''], true)"
											style="text-decoration: none"
											class="text-white clean-button">
											{{genre}}
										</button></span
									>{%else%}
									<span class="genre-badge badge rounded-pill bg-primary"
										><button
											onclick="SetUrlParam(['genre', 'page', 'query'],['{{genre}}', '',''], true)"
											style="text-decoration: none"
											class="text-white clean-button">
											{{genre}}
										</button></span
									>{%endif%} {% endfor %}
								</div>
							</div>
							<div class="card-footer d-flex justify-content-center">
								<a
									class="btn"
									href="/media/setBool?field=Watched&contentId={{show.id}}">
									{% if show.Watched %}
									<i
										class="bi bi-camera-video-fill"
										style="font-size: 1.6rem"></i>
									{% else %}
									<i
										class="bi bi-camera-video"
										style="font-size: 1.6rem"></i>
									{% endif %}
								</a>
								<a
									class="btn"
									href="/media/setBool?field=Downloaded&contentId={{show.id}}">
									{% if show.Downloaded %}
									<i
										class="bi bi-cloud-check-fill"
										style="font-size: 1.6rem"></i>
									{% else %}
									<i
										class="bi bi-cloud-download"
										style="font-size: 1.6rem"></i>
									{% endif %}
								</a>
							</div>
						</div>

						{%endfor%}
					</div>
					<div class="pagination d-flex align-items-center justify-content-center">
						<span
							class="step-links"
							style="font-size: 1rem">
							{% if page_obj.has_previous %}
							<button
								onclick="SetUrlParam('page', '1')"
								class="clean-button">
								<i class="bi bi-chevron-double-left"></i>
							</button>
							<button
								onclick="SetUrlParam('page', '{{page_obj.previous_page_number }}')"
								class="clean-button">
								<i class="bi bi-chevron-left"></i>
							</button>
							{% endif %} {% DottedPageRange page_obj.paginator page_obj.number as page_range %}{%comment%} padding
							{% endcomment %}{% for pageNum in page_range %} {% if pageNum != page_obj.paginator.ELLIPSIS%}
							<button
								onclick="SetUrlParam('page', '{{pageNum}}')"
								class="clean-button">
								{% if pageNum == page_obj.number%}
								<strong>{{pageNum}}</strong>
								{%else%} {{pageNum}} {%endif%}
							</button>
							{%else%} {{pageNum}} {%endif%} {% endfor %} {% if page_obj.has_next %}
							<button
								onclick="SetUrlParam('page', '{{page_obj.next_page_number }}')"
								class="clean-button">
								<i class="bi bi-chevron-right"></i>
							</button>
							<button
								onclick="SetUrlParam('page', '{{ page_obj.paginator.num_pages }}')"
								class="clean-button">
								<i class="bi bi-chevron-double-right"></i>
							</button>
							{% endif %}
						</span>
					</div>
				</div>
			</div>
		</main>
	</body>
</html>
